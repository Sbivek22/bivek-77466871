<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="idea.ico">
  <title>BOOSEInterpreter Docs</title>

  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.66);
      --border: rgba(255,255,255,.12);
      --accent: #7aa2ff;
      --accent2: #7affc4;
      --danger: #ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1000px 600px at 10% 10%, rgba(122,162,255,.22), transparent 55%),
        radial-gradient(900px 500px at 90% 30%, rgba(122,255,196,.16), transparent 60%),
        radial-gradient(700px 500px at 50% 90%, rgba(255,122,180,.10), transparent 60%),
        var(--bg);
      overflow: hidden; /* prevent double scroll; we scroll panes */
    }

    /* Layout */
    .app{
      height: 100%;
      display: grid;
      grid-template-columns: var(--side, 360px) 8px 1fr;
      min-height: 100%;
    }

    /* Sidebar */
    .sidebar{
      height: 100%;
      border-right: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      backdrop-filter: blur(10px);
      padding: 16px;
      overflow: auto;
    }

    .resizer{
      width: 8px;
      cursor: col-resize;
      background: rgba(255,255,255,.03);
      border-right: 1px solid rgba(255,255,255,.06);
    }
    .resizer:hover{ background: rgba(122,162,255,.12); }

    .main{
      height: 100%;
      overflow: auto;
      padding: 18px 18px 24px;
    }

    /* Brand / top */
    .brand{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .brandLeft{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }
    .logo{
      width: 36px;
      height: 36px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: var(--shadow);
      flex: 0 0 auto;
    }
    .brandText{
      min-width: 0;
    }
    .brandText h1{
      font-size: 15px;
      line-height: 1.2;
      margin:0;
      font-weight: 900;
      letter-spacing: .2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .brandText .sub{
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .iconBtn{
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 10px;
      cursor: pointer;
      user-select:none;
    }
    .iconBtn:hover{ background: rgba(255,255,255,.06); }

    /* Inputs */
    .searchRow{
      display:flex;
      gap:10px;
      margin: 10px 0 10px;
    }
    input, select{
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline: none;
      min-width: 0;
    }
    input::placeholder{ color: rgba(255,255,255,.45); }

    .pillrow{
      display:flex;
      gap:8px;
      flex-wrap: wrap;
      margin: 10px 0 12px;
    }
    .pill{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.16);
      color: var(--muted);
      user-select:none;
    }

    /* Sidebar sections */
    .sideSection{
      margin-top: 10px;
    }
    .sideHeader{
      display:flex;
      justify-content: space-between;
      align-items: baseline;
      margin: 10px 0 8px;
    }
    .sideHeader .title{
      font-weight: 900;
      letter-spacing: .2px;
      font-size: 12.5px;
      text-transform: uppercase;
      color: rgba(255,255,255,.82);
    }
    .sideHeader .count{
      font-size: 12px;
      color: var(--muted);
    }

    .nsItem{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      border-radius: 14px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .nsItem summary{
      list-style:none;
      cursor:pointer;
      padding: 10px 10px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }
    .nsItem summary::-webkit-details-marker{ display:none; }
    .nsTitle{
      font-weight: 900;
      font-size: 12.5px;
      color: rgba(255,255,255,.90);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .nsMeta{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }

    .classList{
      padding: 6px;
      border-top: 1px solid rgba(255,255,255,.10);
    }
    .classItem{
      width:100%;
      text-align:left;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text);
      padding: 10px 10px;
      border-radius: 12px;
      display:flex;
      gap:10px;
      cursor:pointer;
    }
    .classItem:hover{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.08);
    }
    .classItem.active{
      background: rgba(122,162,255,.16);
      border-color: rgba(122,162,255,.30);
    }
    .classDot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      margin-top: 4px;
      background: rgba(255,255,255,.35);
      flex: 0 0 auto;
    }
    .classItem.active .classDot{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
    }
    .classMeta{
      min-width:0;
    }
    .className{
      font-family: var(--mono);
      font-size: 12.5px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .classNs{
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    /* Main */
    .stickyTop{
      position: sticky;
      top: 0;
      z-index: 5;
      padding: 10px 0 14px;
      background: linear-gradient(180deg, rgba(11,16,32,.98), rgba(11,16,32,.78), rgba(11,16,32,0));
      backdrop-filter: blur(10px);
    }

    .topbar{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 12px;
    }
    .crumbs{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
      min-width: 0;
    }
    .crumbs code{
      font-family: var(--mono);
      background: rgba(0,0,0,.22);
      border: 1px solid var(--border);
      padding: 2px 6px;
      border-radius: 8px;
      color: var(--text);
      white-space: nowrap;
    }

    .panel{
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .hero{
      padding: 16px 18px;
      background: linear-gradient(135deg, rgba(122,162,255,.15), rgba(122,255,196,.10));
      border-bottom: 1px solid var(--border);
    }
    .heroTitle{
      display:flex;
      align-items:center;
      gap: 10px;
      margin:0;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: .2px;
      min-width: 0;
    }
    .heroTitle code{
      font-family: var(--mono);
      font-size: 14px;
      padding: 3px 8px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      white-space: nowrap;
    }
    .heroSummary{
      margin-top: 8px;
      color: rgba(255,255,255,.78);
      font-size: 13.5px;
      line-height: 1.5;
    }

    .content{
      padding: 12px 16px 18px;
    }

    .sectionRow{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      margin: 6px 0 12px;
      flex-wrap: wrap;
    }
    .sectionRow h2{
      margin:0;
      font-size: 12.5px;
      letter-spacing: .25px;
      text-transform: uppercase;
      color: rgba(255,255,255,.80);
    }

    .tabs{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items:center;
    }
    .tab{
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.16);
      color: var(--muted);
      font-size: 12px;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      color: var(--text);
      border-color: rgba(122,162,255,.35);
      background: rgba(122,162,255,.16);
    }

    .toggle{
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.16);
      color: var(--muted);
      font-size: 12px;
      cursor:pointer;
      user-select:none;
    }
    .toggle.on{
      color: var(--text);
      border-color: rgba(122,255,196,.32);
      background: rgba(122,255,196,.12);
    }

    .memberGrid{
      display:flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    /* density modes */
    .compact details.member summary{ padding: 9px 10px; }
    .compact .mOneLine{ margin-top: 3px; }

    details.member{
      border: 1px solid rgba(255,255,255,.10);
      background: var(--panel2);
      border-radius: 14px;
      overflow:hidden;
    }
    details.member summary{
      list-style: none;
      cursor: pointer;
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
    }
    details.member summary::-webkit-details-marker{ display:none; }
    .mLeft{ min-width:0; }
    .mSig{
      font-family: var(--mono);
      font-size: 12.5px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .mOneLine{
      margin-top: 4px;
      color: var(--muted);
      font-size: 12px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .chev{
      color: rgba(255,255,255,.60);
      font-size: 12px;
      font-family: var(--mono);
      flex: 0 0 auto;
    }
    details.member[open] .chev{ color: var(--text); }

    .mBody{
      padding: 0 12px 12px;
      border-top: 1px solid rgba(255,255,255,.10);
    }

    .kv{
      margin-top: 10px;
      padding: 10px;
      border-radius: 12px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
    }
    .kTitle{
      font-size: 12px;
      font-weight: 900;
      color: rgba(255,255,255,.82);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: .22px;
    }
    .kText{
      font-size: 13px;
      color: rgba(255,255,255,.86);
      line-height: 1.5;
      overflow-wrap: anywhere;
    }
    .paramLine{
      font-family: var(--mono);
      font-size: 12.2px;
      margin: 6px 0;
      color: rgba(255,255,255,.90);
      overflow-wrap: anywhere;
    }
    .paramLine span{
      color: var(--muted);
      font-family: var(--sans);
      margin-left: 8px;
    }

    .empty{
      padding: 14px;
      color: var(--muted);
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: 14px;
      background: rgba(0,0,0,.10);
    }

    .errorBox{
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,107,107,.35);
      background: rgba(255,107,107,.10);
      color: rgba(255,255,255,.92);
    }
    .errorBox .t{
      font-weight: 900;
      color: var(--danger);
      margin-bottom: 8px;
    }

    .mono{ font-family: var(--mono); }

    /* Mobile: collapsible sidebar */
    .mobileBar{
      display:none;
      gap:10px;
      align-items:center;
      margin: 0 0 12px;
    }
    .mobileBar .iconBtn{ width: 100%; }

    @media (max-width: 980px){
      body{ overflow: auto; }
      .app{
        grid-template-columns: 1fr;
        overflow: visible;
      }
      .resizer{ display:none; }
      .sidebar{
        position: fixed;
        inset: 0 18% 0 0;
        z-index: 20;
        transform: translateX(-105%);
        transition: transform .18s ease;
        box-shadow: 0 20px 60px rgba(0,0,0,.55);
      }
      .sidebar.open{ transform: translateX(0); }
      .main{
        height: auto;
        overflow: visible;
      }
      .mobileBar{ display:flex; }
    }
  </style>
</head>

<body>
  <div class="app">
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="brandLeft">
          <div class="logo"></div>
          <div class="brandText">
            <h1>BOOSEInterpreter Docs</h1>
            <div class="sub">From C# XML comments (api.xml)</div>
          </div>
        </div>
        <button class="iconBtn" id="closeSideBtn" title="Close sidebar (mobile)" style="display:none;">Close</button>
      </div>

      <div class="searchRow">
        <input id="classSearch" placeholder="Search namespaces/classes…" />
      </div>

      <div class="pillrow">
        <div class="pill">Namespace → Class navigation</div>
        <div class="pill">Uses docs/api.xml</div>
      </div>

      <div class="sideSection">
        <div class="sideHeader">
          <div class="title">Namespaces</div>
          <div id="classCount" class="count">0</div>
        </div>
        <div id="namespaceArea"></div>
      </div>
    </aside>

    <div class="resizer" id="resizer" title="Drag to resize sidebar"></div>

    <main class="main">
      <div class="mobileBar">
        <button class="iconBtn" id="openSideBtn">Open Menu</button>
      </div>

      <div class="stickyTop">
        <div class="topbar">
          <div class="crumbs" id="crumbs">Select a class from the menu.</div>
          <div style="min-width: 260px; width: min(560px, 100%);">
            <input id="memberSearch" placeholder="Search members in selected class…" disabled />
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="hero">
          <h2 class="heroTitle" id="heroTitle">Documentation</h2>
          <div class="heroSummary" id="heroSummary">
            This site renders your C# <span class="mono">///</span> XML comments. Copy your generated XML doc file to <span class="mono">docs/api.xml</span>.
          </div>
        </div>

        <div class="content">
          <div class="sectionRow">
            <h2>Members</h2>
            <div class="tabs">
              <div id="tabs"></div>
              <div class="toggle" id="densityToggle" title="Toggle compact view">Compact</div>
            </div>
          </div>

          <div id="memberArea"></div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // ---------- Utilities ----------
    function escapeHtml(s) {
      return (s || "").replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[c]));
    }
    function normalize(s) {
      return (s || "").trim().replace(/\s+/g, " ");
    }
    function splitNamespace(fullTypeName){
      const lastDot = fullTypeName.lastIndexOf(".");
      if (lastDot === -1) return { ns: "(global)", short: fullTypeName };
      return { ns: fullTypeName.slice(0, lastDot), short: fullTypeName.slice(lastDot + 1) };
    }

    // member @name formats:
    // T:Namespace.Class
    // M:Namespace.Class.Method(System.Int32)
    // P:Namespace.Class.Prop
    // F:Namespace.Class.Field
    // E:Namespace.Class.Event
    function parseMemberName(raw){
      const idx = raw.indexOf(":");
      const kind = idx >= 0 ? raw.slice(0, idx) : "";
      const rest = idx >= 0 ? raw.slice(idx + 1) : raw;

      const noParams = rest.split("(")[0];

      let owner = "";
      let leaf = noParams;
      if (kind === "T") {
        owner = noParams;
        leaf = noParams;
      } else {
        const lastDot = noParams.lastIndexOf(".");
        owner = lastDot >= 0 ? noParams.slice(0, lastDot) : "";
        leaf = lastDot >= 0 ? noParams.slice(lastDot + 1) : noParams;
      }

      const displayLeaf = (leaf === "#ctor" || leaf === ".ctor") ? "Constructor" : leaf;
      return { kind, full: rest, noParams, owner, leaf: displayLeaf };
    }

    function getFirstText(memberNode, tagName) {
      const el = memberNode.getElementsByTagName(tagName)[0];
      return el ? normalize(el.textContent) : "";
    }

    function readMembers(xmlDoc) {
      const memberNodes = Array.from(xmlDoc.getElementsByTagName("member"));
      return memberNodes.map(n => {
        const rawName = n.getAttribute("name") || "";
        const parsed = parseMemberName(rawName);

        const summary = getFirstText(n, "summary");
        const returns = getFirstText(n, "returns");
        const remarks = getFirstText(n, "remarks");

        const params = Array.from(n.getElementsByTagName("param")).map(p => ({
          name: p.getAttribute("name") || "",
          text: normalize(p.textContent)
        }));

        return {
          rawName,
          kind: parsed.kind,
          owner: parsed.owner,
          noParams: parsed.noParams,
          leaf: parsed.leaf,
          full: parsed.full,
          summary,
          returns,
          remarks,
          params
        };
      }).filter(m => m.rawName);
    }

    async function loadXml() {
      const res = await fetch("./api.xml", { cache: "no-store" });
      if (!res.ok) throw new Error("Cannot load api.xml. Ensure docs/api.xml exists next to index.html.");
      const text = await res.text();
      const doc = new DOMParser().parseFromString(text, "text/xml");
      if (doc.getElementsByTagName("parsererror")[0]) throw new Error("api.xml could not be parsed (invalid XML).");
      return doc;
    }

    // ---------- Build model ----------
    function buildModel(members){
      const types = new Map(); // fullType -> { summary, remarks }
      for (const m of members){
        if (m.kind === "T"){
          types.set(m.owner, { summary: m.summary, remarks: m.remarks });
        }
      }

      const classes = new Map();
      function ensureClass(typeName){
        if (!classes.has(typeName)){
          const info = types.get(typeName) || { summary: "", remarks: "" };
          classes.set(typeName, {
            typeName,
            info,
            groups: { Methods: [], Properties: [], Fields: [], Events: [], Others: [] }
          });
        }
        return classes.get(typeName);
      }

      for (const m of members){
        const typeName = m.owner;
        if (!typeName) continue;

        const c = ensureClass(typeName);

        if (m.kind === "M") c.groups.Methods.push(m);
        else if (m.kind === "P") c.groups.Properties.push(m);
        else if (m.kind === "F") c.groups.Fields.push(m);
        else if (m.kind === "E") c.groups.Events.push(m);
        else if (m.kind === "T") { /* already captured */ }
        else c.groups.Others.push(m);
      }

      const classList = Array.from(classes.values()).sort((a,b) => a.typeName.localeCompare(b.typeName));
      for (const c of classList){
        for (const k of Object.keys(c.groups)){
          c.groups[k].sort((a,b) => a.noParams.localeCompare(b.noParams));
        }
      }
      return classList;
    }

    // ---------- Namespace tree ----------
    function buildNamespaceTree(classList){
      // ns -> [class]
      const map = new Map();
      for (const c of classList){
        const { ns, short } = splitNamespace(c.typeName);
        if (!map.has(ns)) map.set(ns, []);
        map.get(ns).push({ typeName: c.typeName, short });
      }
      for (const [k, v] of map){
        v.sort((a,b) => a.short.localeCompare(b.short));
      }
      return Array.from(map.entries()).sort((a,b) => a[0].localeCompare(b[0]));
    }

    // ---------- UI state ----------
    let ALL_CLASSES = [];
    let SELECTED = null;
    let ACTIVE_TAB = "Methods";
    let MEMBER_QUERY = "";
    let COMPACT = false;

    const elSidebar = document.getElementById("sidebar");
    const elNamespaceArea = document.getElementById("namespaceArea");
    const elClassCount = document.getElementById("classCount");
    const elClassSearch = document.getElementById("classSearch");

    const elCrumbs = document.getElementById("crumbs");
    const elHeroTitle = document.getElementById("heroTitle");
    const elHeroSummary = document.getElementById("heroSummary");

    const elTabs = document.getElementById("tabs");
    const elMemberArea = document.getElementById("memberArea");
    const elMemberSearch = document.getElementById("memberSearch");
    const elDensityToggle = document.getElementById("densityToggle");

    const openSideBtn = document.getElementById("openSideBtn");
    const closeSideBtn = document.getElementById("closeSideBtn");

    function setSelected(typeName){
      SELECTED = ALL_CLASSES.find(c => c.typeName === typeName) || null;
      ACTIVE_TAB = "Methods";
      MEMBER_QUERY = "";
      elMemberSearch.value = "";
      elMemberSearch.disabled = !SELECTED;

      // close sidebar on mobile after selecting
      if (window.matchMedia("(max-width: 980px)").matches){
        elSidebar.classList.remove("open");
      }

      render();
    }

    function renderSidebar(){
      const q = (elClassSearch.value || "").toLowerCase().trim();

      const filtered = q
        ? ALL_CLASSES.filter(c => c.typeName.toLowerCase().includes(q))
        : ALL_CLASSES;

      const tree = buildNamespaceTree(filtered);
      elClassCount.textContent = String(filtered.length);
      elNamespaceArea.innerHTML = "";

      for (const [ns, classes] of tree){
        const details = document.createElement("details");
        details.className = "nsItem";
        details.open = true;

        details.innerHTML = `
          <summary>
            <div class="nsTitle">${escapeHtml(ns)}</div>
            <div class="nsMeta">${classes.length}</div>
          </summary>
          <div class="classList"></div>
        `;

        const list = details.querySelector(".classList");
        for (const c of classes){
          const btn = document.createElement("button");
          btn.className = "classItem" + (SELECTED && SELECTED.typeName === c.typeName ? " active" : "");
          btn.innerHTML = `
            <div class="classDot"></div>
            <div class="classMeta">
              <div class="className">${escapeHtml(c.short)}</div>
              <div class="classNs">${escapeHtml(ns)}</div>
            </div>
          `;
          btn.addEventListener("click", () => setSelected(c.typeName));
          list.appendChild(btn);
        }

        elNamespaceArea.appendChild(details);
      }
    }

    function renderTabs(){
      elTabs.innerHTML = "";
      if (!SELECTED) return;

      const keys = ["Methods","Properties","Fields","Events","Others"];
      for (const k of keys){
        const count = SELECTED.groups[k].length;
        if (count === 0 && k !== "Methods") continue;

        const t = document.createElement("div");
        t.className = "tab" + (ACTIVE_TAB === k ? " active" : "");
        t.textContent = `${k} (${count})`;
        t.addEventListener("click", () => {
          ACTIVE_TAB = k;
          renderMembers();
          renderTabs();
        });
        elTabs.appendChild(t);
      }
    }

    function memberMatches(m){
      if (!MEMBER_QUERY) return true;
      const q = MEMBER_QUERY.toLowerCase();
      return (m.noParams || "").toLowerCase().includes(q)
        || (m.summary || "").toLowerCase().includes(q)
        || (m.remarks || "").toLowerCase().includes(q)
        || (m.full || "").toLowerCase().includes(q);
    }

    function renderMembers(){
      elMemberArea.innerHTML = "";

      if (!SELECTED){
        elMemberArea.innerHTML = `<div class="empty">Select a class from the menu to view its documentation.</div>`;
        return;
      }

      const list = (SELECTED.groups[ACTIVE_TAB] || []).filter(memberMatches);

      if (list.length === 0){
        elMemberArea.innerHTML = `<div class="empty">No members found for this tab/search.</div>`;
        return;
      }

      const wrap = document.createElement("div");
      wrap.className = "memberGrid" + (COMPACT ? " compact" : "");

      for (const m of list){
        const oneLine = m.summary || m.remarks || "(no summary)";
        const sig = m.noParams;

        const paramsBlock = (m.params && m.params.length)
          ? `
            <div class="kv">
              <div class="kTitle">Parameters</div>
              ${m.params.map(p => `
                <div class="paramLine">${escapeHtml(p.name)}<span>${escapeHtml(p.text || "")}</span></div>
              `).join("")}
            </div>
          ` : "";

        const returnsBlock = m.returns
          ? `
            <div class="kv">
              <div class="kTitle">Returns</div>
              <div class="kText">${escapeHtml(m.returns)}</div>
            </div>
          ` : "";

        const remarksBlock = m.remarks
          ? `
            <div class="kv">
              <div class="kTitle">Remarks</div>
              <div class="kText">${escapeHtml(m.remarks)}</div>
            </div>
          ` : "";

        const summaryBlock = `
          <div class="kv">
            <div class="kTitle">Summary</div>
            <div class="kText">${escapeHtml(m.summary || "(no summary)")}</div>
          </div>
        `;

        const details = document.createElement("details");
        details.className = "member";
        details.innerHTML = `
          <summary>
            <div class="mLeft">
              <div class="mSig">${escapeHtml(sig)}</div>
              <div class="mOneLine">${escapeHtml(oneLine)}</div>
            </div>
            <div class="chev">▾</div>
          </summary>
          <div class="mBody">
            ${summaryBlock}
            ${paramsBlock}
            ${returnsBlock}
            ${remarksBlock}
          </div>
        `;
        wrap.appendChild(details);
      }

      elMemberArea.appendChild(wrap);
    }

    function renderHeader(){
      if (!SELECTED){
        elCrumbs.innerHTML = `Select a class from the menu.`;
        elHeroTitle.textContent = "Documentation";
        elHeroSummary.innerHTML =
          `This site renders your C# <span class="mono">///</span> XML comments. Copy your generated XML doc file to <span class="mono">docs/api.xml</span>.`;
        return;
      }

      const { ns, short } = splitNamespace(SELECTED.typeName);
      elCrumbs.innerHTML = `Namespace <code>${escapeHtml(ns)}</code>  •  Class <code>${escapeHtml(short)}</code>`;
      elHeroTitle.innerHTML = `Class <code>${escapeHtml(short)}</code>`;

      const typeSummary = SELECTED.info.summary || SELECTED.info.remarks || "(no summary for this class)";
      elHeroSummary.textContent = typeSummary;
    }

    function render(){
      renderSidebar();
      renderHeader();
      renderTabs();
      renderMembers();
    }

    // ---------- Sidebar resize ----------
    (function initResizer(){
      const resizer = document.getElementById("resizer");
      let dragging = false;

      function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

      resizer.addEventListener("mousedown", (e) => {
        dragging = true;
        document.body.style.userSelect = "none";
      });

      window.addEventListener("mousemove", (e) => {
        if (!dragging) return;
        const w = clamp(e.clientX, 260, 520);
        document.documentElement.style.setProperty("--side", w + "px");
      });

      window.addEventListener("mouseup", () => {
        dragging = false;
        document.body.style.userSelect = "";
      });
    })();

    // ---------- Mobile open/close ----------
    function refreshMobileButtons(){
      const isMobile = window.matchMedia("(max-width: 980px)").matches;
      closeSideBtn.style.display = isMobile ? "inline-block" : "none";
    }
    openSideBtn.addEventListener("click", () => elSidebar.classList.add("open"));
    closeSideBtn.addEventListener("click", () => elSidebar.classList.remove("open"));
    window.addEventListener("resize", refreshMobileButtons);

    // ---------- Init ----------
    (async () => {
      try{
        refreshMobileButtons();

        const xml = await loadXml();
        const members = readMembers(xml);
        ALL_CLASSES = buildModel(members);

        // auto-select a useful class: prefer Form1, else first
        const preferred = ALL_CLASSES.find(c => c.typeName.endsWith(".Form1")) || ALL_CLASSES[0];
        if (preferred) setSelected(preferred.typeName);
        else render();

        elClassSearch.addEventListener("input", renderSidebar);

        elMemberSearch.addEventListener("input", () => {
          MEMBER_QUERY = (elMemberSearch.value || "").trim();
          renderMembers();
        });

        elDensityToggle.addEventListener("click", () => {
          COMPACT = !COMPACT;
          elDensityToggle.classList.toggle("on", COMPACT);
          renderMembers();
        });

      } catch (err){
        document.querySelector(".main").innerHTML = `
          <div class="errorBox">
            <div class="t">Error loading documentation</div>
            <div>${escapeHtml(err.message)}</div>
            <div style="margin-top:10px; color: rgba(255,255,255,.80);">
              Checklist:
              <ol>
                <li>Build your project so <span class="mono">BOOSEInterpreter.xml</span> exists.</li>
                <li>Copy it to <span class="mono">docs/api.xml</span>.</li>
                <li>Open via GitHub Pages or a local server (not file double-click).</li>
              </ol>
            </div>
          </div>
        `;
      }
    })();
  </script>
</body>
</html>
