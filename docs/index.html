<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BOOSEInterpreter XML Docs</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; line-height: 1.4; }
    header { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    input { padding: 10px; font-size: 14px; min-width: 320px; width: min(720px, 100%); }
    .hint { color: #444; margin: 10px 0 18px; }
    .item { border: 1px solid #ddd; border-radius: 10px; padding: 12px; margin: 12px 0; }
    .name { font-weight: 700; font-family: Consolas, monospace; }
    .summary { margin-top: 8px; }
    .meta { margin-top: 10px; font-size: 13px; color: #222; }
    .meta-title { font-weight: 700; margin-bottom: 4px; }
    code { background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }
    .error { color: #b00020; font-weight: 700; }
    .muted { color: #666; }
  </style>
</head>
<body>
  <h1>BOOSEInterpreter Documentation</h1>

  <header>
    <input id="q" placeholder="Search: e.g. T:BOOSEInterpreter, M:Class.Method, MoveTo, DrawTo" />
  </header>

  <div class="hint">
    This page reads <code>api.xml</code> generated from your C# <code>///</code> XML comments.
    <span class="muted">If you see an error, confirm <code>docs/api.xml</code> exists.</span>
  </div>

  <div id="status" class="muted"></div>
  <div id="out"></div>

  <script>
    function escapeHtml(s) {
      return (s || "").replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[c]));
    }

    function normalize(s) {
      return (s || "").trim().replace(/\s+/g, " ");
    }

    async function loadXml() {
      const res = await fetch("./api.xml", { cache: "no-store" });
      if (!res.ok) throw new Error("Cannot load api.xml. Put docs/api.xml next to index.html.");
      const text = await res.text();
      const doc = new DOMParser().parseFromString(text, "text/xml");

      // If XML is invalid, browser returns a <parsererror> node.
      const parserError = doc.getElementsByTagName("parsererror")[0];
      if (parserError) throw new Error("api.xml could not be parsed (invalid XML).");

      return doc;
    }

    function getFirstText(memberNode, tagName) {
      const el = memberNode.getElementsByTagName(tagName)[0];
      return el ? normalize(el.textContent) : "";
    }

    function readMembers(xmlDoc) {
      const memberNodes = Array.from(xmlDoc.getElementsByTagName("member"));
      return memberNodes.map(m => {
        const name = m.getAttribute("name") || "";
        const summary = getFirstText(m, "summary");
        const returns = getFirstText(m, "returns");
        const remarks = getFirstText(m, "remarks");

        const params = Array.from(m.getElementsByTagName("param")).map(p => ({
          name: p.getAttribute("name") || "",
          text: normalize(p.textContent)
        }));

        return { name, summary, returns, remarks, params };
      }).filter(x => x.name); // keep only members with name
    }

    function render(members, query) {
      const out = document.getElementById("out");
      out.innerHTML = "";

      const q = (query || "").toLowerCase();
      const filtered = q
        ? members.filter(m =>
            m.name.toLowerCase().includes(q) ||
            (m.summary || "").toLowerCase().includes(q) ||
            (m.remarks || "").toLowerCase().includes(q)
          )
        : members;

      document.getElementById("status").textContent =
        `Showing ${filtered.length} of ${members.length} members`;

      if (filtered.length === 0) {
        out.innerHTML = "<p>No matches.</p>";
        return;
      }

      for (const m of filtered) {
        const paramsHtml = m.params.length
          ? `
            <div class="meta">
              <div class="meta-title">Parameters</div>
              ${m.params.map(p =>
                `<div><code>${escapeHtml(p.name)}</code> - ${escapeHtml(p.text)}</div>`
              ).join("")}
            </div>
          `
          : "";

        const returnsHtml = m.returns
          ? `<div class="meta"><span class="meta-title">Returns</span> - ${escapeHtml(m.returns)}</div>`
          : "";

        const remarksHtml = m.remarks
          ? `<div class="meta"><span class="meta-title">Remarks</span> - ${escapeHtml(m.remarks)}</div>`
          : "";

        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div class="name">${escapeHtml(m.name)}</div>
          <div class="summary">${escapeHtml(m.summary || "(no summary)")}</div>
          ${paramsHtml}
          ${returnsHtml}
          ${remarksHtml}
        `;
        out.appendChild(div);
      }
    }

    (async () => {
      const q = document.getElementById("q");
      const out = document.getElementById("out");

      try {
        const xml = await loadXml();
        const members = readMembers(xml);
        render(members, "");

        q.addEventListener("input", () => render(members, q.value));
      } catch (err) {
        document.getElementById("status").textContent = "";
        out.innerHTML = `<p class="error">Error: ${escapeHtml(err.message)}</p>
          <p>Fix checklist:</p>
          <ol>
            <li>Build your project so BOOSEInterpreter.xml exists.</li>
            <li>Copy it to <code>docs/api.xml</code>.</li>
            <li>Open using a local server or GitHub Pages (not just file double-click).</li>
          </ol>`;
      }
    })();
  </script>
</body>
</html>
